<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù…ÙˆÙ‚Ø¹ Ø¹ÙÙ…Ø±Ø© - ØªØ¬Ø±Ø¨Ø© Ø°ÙƒÙŠØ©</title>
    <link href="https://fonts.googleapis.com/css2?family=Amiri:wght@400;700&family=Lateef&family=Reem+Kufi:wght@500&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #064e3b;
            --gold: #d4af37;
            --bg: #fdfbf7;
            --text: #1a1a1a;
            --card-bg: #ffffff;
        }

        body {
            font-family: 'Amiri', serif;
            background-color: var(--bg);
            color: var(--text);
            margin: 0; padding: 0;
            scroll-behavior: smooth;
        }

        header {
            background: var(--primary);
            color: white;
            padding: 15px 5%;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            position: sticky; top: 0; z-index: 100;
        }

        .logo { font-family: 'Reem Kufi', sans-serif; font-size: 24px; display: flex; align-items: center; gap: 10px; }
        .logo span { color: var(--gold); }

        .toolbar {
            background: #fff;
            padding: 10px 5%;
            display: flex; flex-wrap: wrap; gap: 15px; align-items: center;
            border-bottom: 1px solid #eee;
        }

        .font-control { display: flex; align-items: center; gap: 10px; font-size: 14px; }
        select, button { padding: 8px 15px; border-radius: 5px; border: 1px solid #ddd; font-family: 'Amiri'; cursor: pointer; }
        .btn-gold { background: var(--gold); color: var(--primary); border: none; font-weight: bold; }
        .btn-resume { background: #e8f5e9; color: var(--primary); border: 1px solid var(--primary); font-size: 13px; display: none; }

        .quran-container {
            max-width: 900px; margin: 20px auto; padding: 40px;
            background: var(--card-bg); border-radius: 8px;
            box-shadow: 0 2px 15px rgba(0,0,0,0.05);
            min-height: 80vh; line-height: 2.8; font-size: 32px; text-align: center;
        }

        .ayah {
            position: relative; cursor: pointer; padding: 0 5px; border-radius: 4px;
            transition: 0.3s; display: inline;
        }
        .ayah:hover { background: rgba(212, 175, 55, 0.1); }
        .ayah.active { background: rgba(212, 175, 55, 0.2); color: var(--primary); border-bottom: 2px solid var(--gold); }
        .ayah-num { font-family: 'Lateef'; color: var(--gold); margin: 0 8px; font-weight: bold; }

        /* Ù†Ø§ÙØ°Ø© Ø§Ù„Ø¹Ù„Ø§Ù…Ø§Øª Ø§Ù„Ù…Ø±Ø¬Ø¹ÙŠØ© */
        .side-menu {
            position: fixed; top: 0; left: -350px; width: 300px; height: 100%;
            background: white; box-shadow: 2px 0 15px rgba(0,0,0,0.2);
            z-index: 1001; transition: 0.4s; padding: 20px; overflow-y: auto;
        }
        .side-menu.open { left: 0; }
        .side-menu h3 { color: var(--primary); border-bottom: 2px solid var(--gold); padding-bottom: 10px; }
        .bookmark-item {
            padding: 12px; border-bottom: 1px solid #eee; cursor: pointer; transition: 0.2s;
        }
        .bookmark-item:hover { background: #f9f9f9; color: var(--gold); }

        /* Ø§Ù„Ù…ÙˆØ¯Ø§Ù„ (Ø§Ù„ØªÙØ³ÙŠØ±) */
        .modal {
            display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.6); z-index: 1000; justify-content: center; align-items: center;
        }
        .modal-content { background: white; padding: 25px; border-radius: 15px; max-width: 500px; width: 90%; }
        
        .overlay { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.3); z-index: 1000; }

        .audio-float { position: fixed; bottom: 20px; left: 20px; background: var(--primary); padding: 10px; border-radius: 30px; display: none; box-shadow: 0 5px 15px rgba(0,0,0,0.3); }
    </style>
</head>
<body>

<div class="overlay" id="overlay" onclick="closeSideMenu()"></div>

<div class="side-menu" id="sideMenu">
    <h3>ğŸ”– Ø¹Ù„Ø§Ù…Ø§ØªÙŠ Ø§Ù„Ù…Ø±Ø¬Ø¹ÙŠØ©</h3>
    <div id="bookmarksList">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¹Ù„Ø§Ù…Ø§Øª Ù…Ø­ÙÙˆØ¸Ø©</div>
</div>

<header>
    <div class="logo">ğŸ•‹ Ù…ÙˆÙ‚Ø¹ <span>Ø¹ÙÙ…Ø±Ø©</span></div>
    <button id="resumeBtn" class="btn-resume" onclick="resumeReading()">Ø§Ø³ØªÙƒÙ…Ø§Ù„ Ø§Ù„Ù‚Ø±Ø§Ø¡Ø© â†©</button>
</header>

<div class="toolbar">
    <select id="surahSelect"><option>Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</option></select>
    
    <div class="font-control">
        <span>Ø­Ø¬Ù… Ø§Ù„Ø®Ø·:</span>
        <input type="range" id="fontSize" min="20" max="60" value="32">
    </div>

    <button onclick="openSideMenu()" class="btn-gold">ğŸ”– Ø§Ù„Ø¹Ù„Ø§Ù…Ø§Øª</button>
</div>

<main id="quranDisplay" class="quran-container">
    Ø¬Ø§Ø±ÙŠ ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ù…ØµØ­Ù Ø§Ù„Ø´Ø±ÙŠÙ...
</main>

<div id="tafsirModal" class="modal">
    <div class="modal-content">
        <div id="tafsirTitle" style="font-weight: bold; color: var(--primary); margin-bottom: 15px;"></div>
        <div id="tafsirBody">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</div>
        <br>
        <button onclick="addBookmark()" class="btn-gold" style="width: 100%;">Ø­ÙØ¸ ÙƒØ¹Ù„Ø§Ù…Ø© Ù…Ø±Ø¬Ø¹ÙŠØ©</button>
        <button onclick="closeModal()" style="width: 100%; margin-top: 10px; border:none; background:none;">Ø¥ØºÙ„Ø§Ù‚</button>
    </div>
</div>

<div class="audio-float" id="audioBox"><audio id="mainAudio" controls></audio></div>

<script>
    const surahSelect = document.getElementById('surahSelect');
    const quranDisplay = document.getElementById('quranDisplay');
    const fontSizeInput = document.getElementById('fontSize');
    const tafsirModal = document.getElementById('tafsirModal');
    const resumeBtn = document.getElementById('resumeBtn');
    
    let currentAyahData = null;
    let bookmarks = JSON.parse(localStorage.getItem('quranBookmarks')) || [];

    // --- 1. Ø§Ù„ØªØ´ØºÙŠÙ„ Ø§Ù„Ø£ÙˆÙ„ ---
    async function init() {
        const res = await fetch('https://api.alquran.cloud/v1/surah');
        const data = await res.json();
        surahSelect.innerHTML = '<option value="">Ø§Ø®ØªØ± Ø§Ù„Ø³ÙˆØ±Ø©...</option>';
        data.data.forEach(s => {
            surahSelect.innerHTML += `<option value="${s.number}">${s.number}. ${s.name}</option>`;
        });

        checkLastRead();
        updateBookmarksUI();
    }

    function checkLastRead() {
        const last = JSON.parse(localStorage.getItem('lastReadPos'));
        if(last) {
            resumeBtn.style.display = 'block';
            resumeBtn.innerText = `Ø§Ø³ØªÙƒÙ…Ø§Ù„: Ø³ÙˆØ±Ø© ${last.surahName} (Ø¢ÙŠØ© ${last.ayahInSurah})`;
        }
    }

    // --- 2. ÙˆØ¸ÙŠÙØ© Ø§Ù„Ø§Ù†ØªÙ‚Ø§Ù„ Ù„Ø¢ÙŠØ© Ù…Ø¹ÙŠÙ†Ø© (Ø§Ù„Ù‚Ù„Ø¨ Ø§Ù„Ù†Ø§Ø¨Ø¶ Ù„Ù„ØªØ·Ø¨ÙŠÙ‚) ---
    async function goToAyah(surahNum, ayahInSurah) {
        surahSelect.value = surahNum;
        quranDisplay.innerHTML = "Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø§Ù†ØªÙ‚Ø§Ù„...";
        
        try {
            const res = await fetch(`https://api.alquran.cloud/v1/surah/${surahNum}`);
            const data = await res.json();
            renderSurah(data.data);

            // Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø± Ù‚Ù„ÙŠÙ„Ø§Ù‹ Ù„Ù„ØªØ£ÙƒØ¯ Ù…Ù† Ø§Ù„Ø±Ù†Ø¯Ø± Ø«Ù… Ø§Ù„ØªÙ…Ø±ÙŠØ±
            setTimeout(() => {
                const target = document.getElementById(`ayah-${ayahInSurah}`);
                if(target) {
                    target.scrollIntoView({ behavior: 'smooth', block: 'center' });
                    target.classList.add('active');
                    // Ø¥Ø²Ø§Ù„Ø© Ø§Ù„ØªÙ…ÙŠÙŠØ² Ø¨Ø¹Ø¯ 3 Ø«ÙˆØ§Ù†ÙŠ
                    setTimeout(() => target.classList.remove('active'), 3000);
                }
            }, 500);
        } catch(e) { alert("Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ø§Ù†ØªÙ‚Ø§Ù„"); }
    }

    function resumeReading() {
        const last = JSON.parse(localStorage.getItem('lastReadPos'));
        if(last) goToAyah(last.surahNum, last.ayahInSurah);
    }

    // --- 3. Ø¹Ø±Ø¶ Ø§Ù„Ø³ÙˆØ±Ø© ---
    function renderSurah(surah) {
        quranDisplay.innerHTML = (surah.number != 1 && surah.number != 9) ? 
            `<div style="font-size: 1.2em; margin-bottom: 20px;">Ø¨ÙØ³Ù’Ù…Ù Ø§Ù„Ù„Ù‘ÙÙ‡Ù Ø§Ù„Ø±Ù‘ÙØ­Ù’Ù…ÙÙ°Ù†Ù Ø§Ù„Ø±Ù‘ÙØ­ÙÙŠÙ…Ù</div>` : '';

        surah.ayahs.forEach(ayah => {
            const span = document.createElement('span');
            span.className = 'ayah';
            span.id = `ayah-${ayah.numberInSurah}`; // Ù…Ø¹Ø±Ù ÙØ±ÙŠØ¯ Ù„ÙƒÙ„ Ø¢ÙŠØ©
            
            let text = ayah.text;
            if(ayah.numberInSurah === 1 && surah.number != 1) text = text.replace('Ø¨ÙØ³Ù’Ù…Ù Ø§Ù„Ù„Ù‘ÙÙ‡Ù Ø§Ù„Ø±Ù‘ÙØ­Ù’Ù…ÙÙ°Ù†Ù Ø§Ù„Ø±Ù‘ÙØ­ÙÙŠÙ…Ù', '');
            
            span.innerHTML = `${text} <span class="ayah-num">ï´¿${ayah.numberInSurah}ï´¾</span>`;
            
            // Ø§Ù„Ø¶ØºØ· Ø§Ù„Ù…Ø·ÙˆÙ„ Ù„Ù„ØªÙØ³ÙŠØ±
            let timer;
            span.onmousedown = span.ontouchstart = () => timer = setTimeout(() => showTafsir(ayah, surah), 700);
            span.onmouseup = span.ontouchend = () => clearTimeout(timer);

            // Ø¶ØºØ·Ø© Ø¹Ø§Ø¯ÙŠØ© Ù„Ù„Ø­ÙØ¸ Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ ÙˆØ§Ù„ØªØ´ØºÙŠÙ„
            span.onclick = () => {
                saveProgress(surah, ayah);
                playAudio(ayah.number);
                document.querySelectorAll('.ayah').forEach(a => a.classList.remove('active'));
                span.classList.add('active');
            };

            quranDisplay.appendChild(span);
        });
    }

    function saveProgress(surah, ayah) {
        const pos = {
            surahNum: surah.number,
            surahName: surah.name,
            ayahInSurah: ayah.numberInSurah,
            absoluteAyahNum: ayah.number
        };
        localStorage.setItem('lastReadPos', JSON.stringify(pos));
        checkLastRead();
    }

    // --- 4. Ø§Ù„ØªÙØ³ÙŠØ± ÙˆØ§Ù„Ø¹Ù„Ø§Ù…Ø§Øª ---
    async function showTafsir(ayah, surah) {
        currentAyahData = { ...ayah, surahName: surah.name, surahNum: surah.number };
        tafsirModal.style.display = 'flex';
        document.getElementById('tafsirTitle').innerText = `ØªÙØ³ÙŠØ± Ø§Ù„Ø¢ÙŠØ© ${ayah.numberInSurah} - Ø³ÙˆØ±Ø© ${surah.name}`;
        
        const res = await fetch(`https://api.alquran.cloud/v1/ayah/${ayah.number}/ar.jalalayn`);
        const data = await res.json();
        document.getElementById('tafsirBody').innerText = data.data.text;
    }

    function addBookmark() {
        const entry = {
            surahNum: currentAyahData.surahNum,
            ayahInSurah: currentAyahData.numberInSurah,
            title: `Ø³ÙˆØ±Ø© ${currentAyahData.surahName} (${currentAyahData.numberInSurah})`
        };
        if(!bookmarks.find(b => b.title === entry.title)) {
            bookmarks.push(entry);
            localStorage.setItem('quranBookmarks', JSON.stringify(bookmarks));
            updateBookmarksUI();
            alert("ØªÙ… Ø­ÙØ¸ Ø§Ù„Ø¹Ù„Ø§Ù…Ø©");
        }
        closeModal();
    }

    function updateBookmarksUI() {
        const list = document.getElementById('bookmarksList');
        if(bookmarks.length === 0) {
            list.innerHTML = "Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¹Ù„Ø§Ù…Ø§Øª Ù…Ø­ÙÙˆØ¸Ø©";
            return;
        }
        list.innerHTML = bookmarks.map((b, index) => `
            <div class="bookmark-item" onclick="goToAyah(${b.surahNum}, ${b.ayahInSurah}); closeSideMenu();">
                ${b.title}
                <small style="display:block; color:#999;">Ø§Ø¶ØºØ· Ù„Ù„Ø§Ù†ØªÙ‚Ø§Ù„ Ø§Ù„ÙÙˆØ±ÙŠ</small>
            </div>
        `).join('');
    }

    // --- 5. Ø§Ù„ØªØ­ÙƒÙ… ÙÙŠ Ø§Ù„ÙˆØ§Ø¬Ù‡Ø© ---
    function openSideMenu() { 
        document.getElementById('sideMenu').classList.add('open');
        document.getElementById('overlay').style.display = 'block';
    }
    function closeSideMenu() { 
        document.getElementById('sideMenu').classList.remove('open');
        document.getElementById('overlay').style.display = 'none';
    }
    function closeModal() { tafsirModal.style.display = 'none'; }
    
    surahSelect.onchange = (e) => { if(e.target.value) goToAyah(e.target.value, 1); };
    fontSizeInput.oninput = (e) => quranDisplay.style.fontSize = e.target.value + 'px';
    
    function playAudio(num) {
        const audio = document.getElementById('mainAudio');
        document.getElementById('audioBox').style.display = 'block';
        audio.src = `https://cdn.islamic.network/quran/audio/128/ar.alafasy/${num}.mp3`;
        audio.play();
    }

    init();
</script>
</body>
</html>
